#include "rain_predictor_model.h"
#include "embedia_debug.h"

// Prototipos inicialización
normalization_t init_standard_scaler_data(void);
dense_layer_t init_dense_3_data(void);
dense_layer_t init_dense_4_data(void);
dense_layer_t init_dense_5_data(void);


// Variables Globales
normalization_t standard_scaler_data;
dense_layer_t dense_3_data;
dense_layer_t dense_4_data;
dense_layer_t dense_5_data;


void model_init(){
    standard_scaler_data = init_standard_scaler_data();
    dense_3_data = init_dense_3_data();
    dense_4_data = init_dense_4_data();
    dense_5_data = init_dense_5_data();

}

void model_predict(data1d_t input, data1d_t * output){
  
    data1d_t output0;

    //*************** LAYER 0 ***************//
    // Layer name: standard_scaler
    standard_norm_layer(standard_scaler_data, input, &output0);
    // Debug function for layer standard_scaler
    print_data1d_t("standard_scaler", output0);

    input = output0;

    //*************** LAYER 1 ***************//
    // Layer name: dense_3
    dense_layer(dense_3_data, input, &output0);
    // Activation layer for dense_3
    sigmoid_activation(output0.data, 16);
    // Debug function for layer dense_3
    print_data1d_t("dense_3", output0);

    input = output0;

    //*************** LAYER 2 ***************//
    // Layer name: dense_4
    dense_layer(dense_4_data, input, &output0);
    // Debug function for layer dense_4
    print_data1d_t("dense_4", output0);

    //*************** LAYER 3 ***************//
    // Layer name: activation_1
    sigmoid_activation(output0.data, 8);
    // Debug function for layer activation_1
    print_data1d_t("activation_1", output0);

    input = output0;

    //*************** LAYER 4 ***************//
    // Layer name: dense_5
    dense_layer(dense_5_data, input, &output0);
    // Activation layer for dense_5
    sigmoid_activation(output0.data, 1);
    // Debug function for layer dense_5
    print_data1d_t("dense_5", output0);


    *output = output0;

}

int model_predict_class(data1d_t input, data1d_t * results){
  
   
    model_predict(input, results);
    
        return argmax(*results); 
    //return argmax(data1d_t);

}

// Implementación de funciones de inicialización


normalization_t init_standard_scaler_data(void){

    static const float sub_val [] = {
    26.4, 12.488235294117647, 1009.0493529411764, 67.95294117647059, 24.270588235294117, 
    32.741176470588236, 20.111764705882354, 16.688235294117646, 8.24705882352941, 1011.6823529411764, 
    1004.8529411764706
    };
    static const float inv_div_val [] = {
    1/6.160023, 1/9.098312, 1/6.433158, 1/23.074766, 1/20.303514, 1/6.123538, 1/6.657537, 
    1/7.384593, 1/10.534990, 1/6.541653, 1/6.954188
    };

    static const normalization_t norm = { sub_val, inv_div_val };
    return norm;
}

dense_layer_t init_dense_3_data(void){

    static neuron_t neurons[16];

    static  float weights0 [] = {
    0.3561869263648987, -0.17527823150157928, 0.47879937291145325, -0.5205274820327759, 
    -0.21107138693332672, 0.23550911247730255, -0.5227197408676147, -0.11968432366847992, 
    -0.23794464766979218, 0.1480170488357544, -0.07040685415267944
    };
    static const neuron_t neuron0 = {weights0, 0.34518977999687195};
    neurons[0]=neuron0;

    static  float weights1 [] = {
    0.18838995695114136, 0.024911295622587204, -0.1612742692232132, -0.5579425692558289, 
    -0.5641657710075378, 0.047647736966609955, -0.06528691947460175, -0.4055746793746948, 
    0.28450459241867065, 0.3099121153354645, 0.0740792378783226
    };
    static const neuron_t neuron1 = {weights1, 0.5552709698677063};
    neurons[1]=neuron1;

    static  float weights2 [] = {
    -0.25892335176467896, 0.16674363613128662, -0.5504105687141418, 0.33270499110221863, 
    0.34694674611091614, -0.17595966160297394, 0.1962030827999115, 0.16847573220729828, 
    -0.07324063777923584, -0.18353688716888428, 0.1095074713230133
    };
    static const neuron_t neuron2 = {weights2, -0.24825434386730194};
    neurons[2]=neuron2;

    static  float weights3 [] = {
    -0.3066459000110626, -0.05525248497724533, 0.1515968292951584, -0.41470253467559814, 
    -0.18482664227485657, 0.5790281295776367, -0.7432920336723328, -0.43433651328086853, 
    -0.10880464315414429, 0.027884632349014282, -0.011231130920350552
    };
    static const neuron_t neuron3 = {weights3, 0.19157373905181885};
    neurons[3]=neuron3;

    static  float weights4 [] = {
    0.13262639939785004, -0.1066005676984787, 0.004357262048870325, -0.5840703845024109, 
    -0.48451828956604004, 0.18086393177509308, -0.1063230037689209, -0.3059873580932617, 
    0.2522275745868683, 0.1553548127412796, 0.06536708772182465
    };
    static const neuron_t neuron4 = {weights4, 0.5494274497032166};
    neurons[4]=neuron4;

    static  float weights5 [] = {
    0.27982020378112793, 0.3471362292766571, -0.4860709011554718, 0.5842709541320801, 
    0.3938916325569153, -0.4462030231952667, -0.39967769384384155, -0.3063911199569702, 
    0.19525443017482758, 0.029849130660295486, -0.26445457339286804
    };
    static const neuron_t neuron5 = {weights5, -0.42166048288345337};
    neurons[5]=neuron5;

    static  float weights6 [] = {
    0.062350671738386154, -0.2698720097541809, 0.5302299857139587, -0.1923375129699707, 
    -0.4876062273979187, 0.08236809074878693, -0.10932543128728867, -0.37977609038352966, 
    0.1774333268404007, 0.0504201240837574, -0.33320528268814087
    };
    static const neuron_t neuron6 = {weights6, 0.3510306775569916};
    neurons[6]=neuron6;

    static  float weights7 [] = {
    -0.020909717306494713, -0.3846733272075653, 0.14556308090686798, -0.6097866296768188, 
    -0.3312027156352997, 0.05761530622839928, 0.3955531716346741, 0.021677764132618904, 
    -0.5181677341461182, -0.04625068977475166, 0.41224709153175354
    };
    static const neuron_t neuron7 = {weights7, 0.46961864829063416};
    neurons[7]=neuron7;

    static  float weights8 [] = {
    -0.23327398300170898, 0.24592071771621704, 0.3721011281013489, -0.7423691749572754, 
    -0.3410469889640808, 0.5587471127510071, 0.20255176723003387, -0.21540124714374542, 
    0.331138551235199, 0.4560258388519287, 0.29985249042510986
    };
    static const neuron_t neuron8 = {weights8, 0.47312355041503906};
    neurons[8]=neuron8;

    static  float weights9 [] = {
    -0.18806315958499908, -0.3009341359138489, -0.33472636342048645, -0.6920246481895447, 
    -0.3106759786605835, 0.2463015764951706, -0.3671349883079529, -0.3287377655506134, 
    -0.1996028870344162, 0.026387402787804604, 0.08593951910734177
    };
    static const neuron_t neuron9 = {weights9, 0.4348002076148987};
    neurons[9]=neuron9;

    static  float weights10 [] = {
    0.019109973683953285, 0.3346414566040039, 0.26116740703582764, 0.09360123425722122, 
    -0.6852136254310608, 0.6101712584495544, 0.20829273760318756, 0.13281604647636414, 
    -0.2655893862247467, 0.47920456528663635, 0.46060213446617126
    };
    static const neuron_t neuron10 = {weights10, 0.48842307925224304};
    neurons[10]=neuron10;

    static  float weights11 [] = {
    -0.00998783204704523, -0.35662218928337097, -0.3312246799468994, 0.224898561835289, 
    0.8490460515022278, -0.37924253940582275, 0.1293572187423706, -0.41983112692832947, 
    0.08325715363025665, -0.35112595558166504, -0.11974474787712097
    };
    static const neuron_t neuron11 = {weights11, -0.6642513871192932};
    neurons[11]=neuron11;

    static  float weights12 [] = {
    -0.1698397397994995, 0.11159648001194, 0.2265346199274063, -0.6110429763793945, 
    -0.48085883259773254, 0.06693302094936371, 0.11899906396865845, -0.40790778398513794, 
    0.02215028926730156, -0.3841972351074219, 0.4539973735809326
    };
    static const neuron_t neuron12 = {weights12, 0.33769214153289795};
    neurons[12]=neuron12;

    static  float weights13 [] = {
    0.22426968812942505, 0.05937020108103752, 0.20299723744392395, -0.15958277881145477, 
    -0.4008391201496124, -0.03225482255220413, 0.23486408591270447, -0.3422342538833618, 
    -0.1184132993221283, 0.5453490018844604, 0.2894475758075714
    };
    static const neuron_t neuron13 = {weights13, 0.3005712032318115};
    neurons[13]=neuron13;

    static  float weights14 [] = {
    -0.16352184116840363, -0.02332491986453533, 0.35919106006622314, -0.7409785985946655, 
    -0.4481202960014343, 0.21266131103038788, -0.19555610418319702, 0.03228987008333206, 
    0.17151297628879547, 0.06527170538902283, -0.07399322092533112
    };
    static const neuron_t neuron14 = {weights14, 0.4425230026245117};
    neurons[14]=neuron14;

    static  float weights15 [] = {
    -0.267815500497818, -0.008447296917438507, 0.5043982267379761, -0.4740737974643707, 
    -0.3161446750164032, 0.39811405539512634, -0.29845064878463745, -0.5599793195724487, 
    0.24830640852451324, -0.1582334339618683, -0.12301849573850632
    };
    static const neuron_t neuron15 = {weights15, 0.29061266779899597};
    neurons[15]=neuron15;

    dense_layer_t layer= {16, neurons};
    return layer;
}

dense_layer_t init_dense_4_data(void){

    static neuron_t neurons[8];

    static  float weights0 [] = {
    0.14383046329021454, -0.8563756346702576, 0.4099177420139313, -0.5409014821052551, 
    -0.5491296052932739, 0.48234567046165466, -0.5724278688430786, -0.37733936309814453, 
    -0.5276567339897156, -0.5490583777427673, -0.06597712635993958, 0.8133113384246826, 
    -0.5175926685333252, -0.45706707239151, 0.05838650465011597, -0.06622505933046341, 
  
    };
    static const neuron_t neuron0 = {weights0, -0.02214483544230461};
    neurons[0]=neuron0;

    static  float weights1 [] = {
    -0.6386168003082275, -0.8701286911964417, 0.6457634568214417, -0.15438207983970642, 
    -0.6482139229774475, 0.5285277962684631, -0.6838829517364502, -0.1033344492316246, 
    0.11174025386571884, -0.3109356760978699, 0.10382215678691864, 0.4446161985397339, 
    -0.1827968806028366, -0.6594328284263611, -0.43367037177085876, -0.8207237720489502, 
  
    };
    static const neuron_t neuron1 = {weights1, 0.061695750802755356};
    neurons[1]=neuron1;

    static  float weights2 [] = {
    0.4281351864337921, -0.034669049084186554, -0.5856994390487671, 0.704099178314209, 
    0.3006154000759125, -0.4628564715385437, 0.6222386360168457, -0.11989495903253555, 
    0.4084194004535675, 0.7819693684577942, 0.3309544324874878, -0.1881587952375412, 
    -0.056373801082372665, -0.18893596529960632, 0.35354384779930115, 0.6000795960426331, 
  
    };
    static const neuron_t neuron2 = {weights2, -0.045567598193883896};
    neurons[2]=neuron2;

    static  float weights3 [] = {
    0.40504521131515503, 0.3013432025909424, -0.3830331563949585, 0.486553817987442, 
    0.5849052667617798, -0.5615645051002502, 0.5059393644332886, 0.618330180644989, 
    -0.06604157388210297, 0.09422529488801956, 0.7411251664161682, -0.7091683745384216, 
    0.2860124707221985, 0.4750068783760071, 0.583242654800415, 0.5098400712013245
    };
    static const neuron_t neuron3 = {weights3, -0.03658405691385269};
    neurons[3]=neuron3;

    static  float weights4 [] = {
    -0.1977631151676178, -0.5078162550926208, 0.0434090755879879, -0.5346551537513733, 
    0.038735415786504745, -0.011186499148607254, -0.02638629637658596, -0.6956024169921875, 
    -0.0002003578410949558, 0.0796988308429718, -0.08013661205768585, 0.7804979085922241, 
    -0.5749021172523499, -0.7319302558898926, 0.09149297326803207, -0.251939982175827, 
  
    };
    static const neuron_t neuron4 = {weights4, 0.031609416007995605};
    neurons[4]=neuron4;

    static  float weights5 [] = {
    0.7931811213493347, 0.6616005897521973, -0.40011066198349, -0.12750022113323212, 
    0.6499376893043518, -0.3973863124847412, 0.7457139492034912, 0.6417235136032104, 
    0.07672984898090363, 0.7264038920402527, 0.22164571285247803, -0.45050686597824097, 
    0.5699756145477295, 0.5872703194618225, 0.6118603944778442, 0.31893298029899597, 
  
    };
    static const neuron_t neuron5 = {weights5, -0.20609445869922638};
    neurons[5]=neuron5;

    static  float weights6 [] = {
    0.3331749737262726, 0.7971636056900024, -0.2681215703487396, 0.7228151559829712, 
    0.1254153996706009, -0.43321001529693604, 0.10366161167621613, 0.3480116128921509, 
    0.6884031295776367, 0.3782418370246887, 0.7119349241256714, -0.2827189862728119, 
    -0.012108839116990566, -0.2778133749961853, 0.6963232755661011, 0.7251694798469543, 
  
    };
    static const neuron_t neuron6 = {weights6, -0.18231818079948425};
    neurons[6]=neuron6;

    static  float weights7 [] = {
    -0.6342829465866089, -0.07411307096481323, 0.5603663325309753, 0.14828915894031525, 
    -0.7101239562034607, 0.47765007615089417, -0.6212881803512573, 0.2150896042585373, 
    -0.5049152970314026, -0.5760606527328491, -0.5089370012283325, 0.2187276929616928, 
    -0.1404271423816681, -0.5671770572662354, -0.44345909357070923, 0.04179663211107254, 
  
    };
    static const neuron_t neuron7 = {weights7, 0.040046948939561844};
    neurons[7]=neuron7;

    dense_layer_t layer= {8, neurons};
    return layer;
}

dense_layer_t init_dense_5_data(void){

    static neuron_t neurons[1];

    static  float weights0 [] = {
    0.37362462282180786, 0.30393487215042114, -1.028700351715088, -0.9878612756729126, 
    0.8301668763160706, -0.5480241179466248, -0.8283924460411072, 1.0590641498565674, 
  
    };
    static const neuron_t neuron0 = {weights0, -0.10321613401174545};
    neurons[0]=neuron0;

    dense_layer_t layer= {1, neurons};
    return layer;
}
