#include "rain_predictor_model.h"
#include "embedia_debug.h"

// Prototipos inicialización
normalization_t init_standard_scaler_data(void);
dense_layer_t init_dense_12_data(void);
dense_layer_t init_dense_13_data(void);
dense_layer_t init_dense_14_data(void);


// Variables Globales
normalization_t standard_scaler_data;
dense_layer_t dense_12_data;
dense_layer_t dense_13_data;
dense_layer_t dense_14_data;


void model_init(){
    standard_scaler_data = init_standard_scaler_data();
    dense_12_data = init_dense_12_data();
    dense_13_data = init_dense_13_data();
    dense_14_data = init_dense_14_data();

}

void model_predict(data1d_t input, data1d_t * output){
  
    data1d_t output0;

    //*************** LAYER 0 ***************//
    // Layer name: standard_scaler
    standard_norm_layer(standard_scaler_data, input, &output0);
    // Debug function for layer standard_scaler
    print_data1d_t("standard_scaler", output0);

    input = output0;

    //*************** LAYER 1 ***************//
    // Layer name: dense_12
    dense_layer(dense_12_data, input, &output0);
    // Activation layer for dense_12
    tanh_activation(output0.data, 16);
    // Debug function for layer dense_12
    print_data1d_t("dense_12", output0);

    input = output0;

    //*************** LAYER 2 ***************//
    // Layer name: dense_13
    dense_layer(dense_13_data, input, &output0);
    // Activation layer for dense_13
    tanh_activation(output0.data, 8);
    // Debug function for layer dense_13
    print_data1d_t("dense_13", output0);

    input = output0;

    //*************** LAYER 3 ***************//
    // Layer name: dense_14
    dense_layer(dense_14_data, input, &output0);
    // Activation layer for dense_14
    tanh_activation(output0.data, 1);
    // Debug function for layer dense_14
    print_data1d_t("dense_14", output0);


    *output = output0;

}

int model_predict_class(data1d_t input, data1d_t * results){
  
   
    model_predict(input, results);
    
        return argmax(*results); 
    //return argmax(data1d_t);

}

// Implementación de funciones de inicialización


normalization_t init_standard_scaler_data(void){

    static const float sub_val[] ={
    26.4, 12.488235294117647, 1009.0493529411764, 67.95294117647059, 24.270588235294117, 
    32.741176470588236, 20.111764705882354, 16.688235294117646, 8.24705882352941, 1011.6823529411764, 
    1004.8529411764706
    };
    static const float inv_div_val[] ={
    1/6.160023, 1/9.098312, 1/6.433158, 1/23.074766, 1/20.303514, 1/6.123538, 1/6.657537, 
    1/7.384593, 1/10.534990, 1/6.541653, 1/6.954188
    };

    static const normalization_t norm = { sub_val, inv_div_val };
    return norm;
}

dense_layer_t init_dense_12_data(void){

    static neuron_t neurons[16];

    static  float weights0[] ={
    -0.35328301787376404, -0.5113736391067505, -0.05966741219162941, -0.19746248424053192, 
    -0.47915998101234436, -0.08530126512050629, -0.16555975377559662, 0.23501922190189362, 
    -0.2866448163986206, 0.5332837104797363, 0.5461788773536682
    };
    static const neuron_t neuron0 = {weights0, 0.09873950481414795};
    neurons[0]=neuron0;

    static  float weights1[] ={
    0.03107762522995472, -0.31022748351097107, 0.31072670221328735, 0.11954189836978912, 
    -0.07097135484218597, -0.2068070024251938, -0.1290196031332016, 0.24447572231292725, 
    0.3257465958595276, -0.4828227162361145, -0.00262760603800416
    };
    static const neuron_t neuron1 = {weights1, -0.0019898260943591595};
    neurons[1]=neuron1;

    static  float weights2[] ={
    0.05411732196807861, -0.4959200322628021, 0.22402597963809967, -0.36126187443733215, 
    0.33949747681617737, -0.40288424491882324, 0.19694411754608154, 0.29440242052078247, 
    0.35784727334976196, 0.034339334815740585, 0.09927079826593399
    };
    static const neuron_t neuron2 = {weights2, -0.06514276564121246};
    neurons[2]=neuron2;

    static  float weights3[] ={
    -0.4469446539878845, -0.14490093290805817, -0.05057687312364578, -0.2743045687675476, 
    -0.28182610869407654, 0.32220008969306946, 0.11373654007911682, 0.05638799071311951, 
    0.47640323638916016, 0.2623099088668823, -0.35895389318466187
    };
    static const neuron_t neuron3 = {weights3, 0.052372850477695465};
    neurons[3]=neuron3;

    static  float weights4[] ={
    -0.21239331364631653, -0.27492791414260864, 0.014587297104299068, -0.044552091509103775, 
    0.1454578936100006, 0.19922658801078796, -0.4639969766139984, -0.11227419972419739, 
    -0.5309709906578064, -0.14887288212776184, 0.05521123856306076
    };
    static const neuron_t neuron4 = {weights4, -0.011841989122331142};
    neurons[4]=neuron4;

    static  float weights5[] ={
    -0.4549538195133209, 0.1192978173494339, -0.027168743312358856, 0.040000058710575104, 
    0.4242469072341919, 0.08637553453445435, 0.2632252275943756, 0.032981228083372116, 
    -0.2740163803100586, 0.2240777313709259, -0.4026878774166107
    };
    static const neuron_t neuron5 = {weights5, 0.04494425654411316};
    neurons[5]=neuron5;

    static  float weights6[] ={
    0.03237483650445938, -0.1488601714372635, 0.2648388147354126, -0.3301388621330261, 
    0.027593538165092468, -0.24809297919273376, -0.33974409103393555, 0.29457730054855347, 
    0.1363140046596527, -0.3972264230251312, 0.2871363162994385
    };
    static const neuron_t neuron6 = {weights6, 0.05445762723684311};
    neurons[6]=neuron6;

    static  float weights7[] ={
    -0.02503315545618534, -0.16650311648845673, -0.4540219306945801, -0.30063655972480774, 
    -0.0585489496588707, 0.29172736406326294, -0.4940488040447235, 0.4259660542011261, 
    -0.35375112295150757, 0.09137662500143051, -0.31173741817474365
    };
    static const neuron_t neuron7 = {weights7, 0.016640979796648026};
    neurons[7]=neuron7;

    static  float weights8[] ={
    -0.3593423366546631, 0.35341331362724304, 0.28934741020202637, 0.157395139336586, 
    -0.586624026298523, 0.20969410240650177, -0.2762835621833801, 0.3149387836456299, 
    0.017902327701449394, -0.5068873167037964, -0.12463457882404327
    };
    static const neuron_t neuron8 = {weights8, -0.08212112635374069};
    neurons[8]=neuron8;

    static  float weights9[] ={
    0.08447026461362839, -0.35760876536369324, 0.022619737312197685, -0.19307972490787506, 
    -0.002085799351334572, -0.2225668728351593, 0.3658338189125061, 0.4399566352367401, 
    0.47384747862815857, -0.35566526651382446, 0.08800199627876282
    };
    static const neuron_t neuron9 = {weights9, -0.011156067252159119};
    neurons[9]=neuron9;

    static  float weights10[] ={
    0.4504288136959076, 0.2766144871711731, -0.22474560141563416, -0.24534136056900024, 
    -0.5187517404556274, -0.10901793837547302, 0.22818034887313843, -0.1365421563386917, 
    0.25148916244506836, 0.2355017364025116, -0.5400192737579346
    };
    static const neuron_t neuron10 = {weights10, 0.032492510974407196};
    neurons[10]=neuron10;

    static  float weights11[] ={
    0.06298385560512543, 0.20750123262405396, 0.2845025956630707, 0.04438578337430954, 
    0.0017920649843290448, -0.08438070863485336, 0.16641835868358612, -0.3572724759578705, 
    0.031075457111001015, -0.02269119955599308, 0.12151102721691132
    };
    static const neuron_t neuron11 = {weights11, 0.017347244545817375};
    neurons[11]=neuron11;

    static  float weights12[] ={
    0.044125404208898544, -0.41756725311279297, -0.2907107174396515, -0.2894479036331177, 
    0.2737260162830353, -0.33096805214881897, -0.11368642002344131, -0.3092558979988098, 
    0.27408134937286377, -0.16174258291721344, -0.3479667603969574
    };
    static const neuron_t neuron12 = {weights12, -0.062339361757040024};
    neurons[12]=neuron12;

    static  float weights13[] ={
    0.4014183580875397, -0.1425027698278427, -0.38909679651260376, -0.3474595546722412, 
    -0.20535138249397278, 0.09573303908109665, -0.03922993317246437, -0.13636820018291473, 
    0.022292042151093483, 0.37784650921821594, -0.3336617350578308
    };
    static const neuron_t neuron13 = {weights13, -0.01930052787065506};
    neurons[13]=neuron13;

    static  float weights14[] ={
    0.010976377874612808, 0.3408389091491699, -0.013595514930784702, 0.2908036410808563, 
    -0.0029866748955100775, 0.09021925926208496, 0.36353054642677307, -0.021609768271446228, 
    -0.0859529972076416, -0.18975210189819336, -0.25134041905403137
    };
    static const neuron_t neuron14 = {weights14, 0.027896316722035408};
    neurons[14]=neuron14;

    static  float weights15[] ={
    0.09605861455202103, 0.4939817190170288, -0.4567382037639618, -0.24556338787078857, 
    0.4216504991054535, 0.09417705982923508, 0.048630084842443466, 0.15354666113853455, 
    0.14649948477745056, 0.18824276328086853, 0.02475094608962536
    };
    static const neuron_t neuron15 = {weights15, -0.051355164498090744};
    neurons[15]=neuron15;

    dense_layer_t layer= {16, neurons};
    return layer;
}

dense_layer_t init_dense_13_data(void){

    static neuron_t neurons[8];

    static  float weights0[] ={
    0.09972372651100159, 0.08751311898231506, 0.3874424993991852, -0.17766915261745453, 
    0.0019419899908825755, 0.05139315128326416, -0.5349516868591309, -0.31971341371536255, 
    0.03814223036170006, -0.19833528995513916, 0.05406031012535095, -0.1605515331029892, 
    0.04007465019822121, -0.15469953417778015, 0.4888254404067993, 0.3551666736602783, 
  
    };
    static const neuron_t neuron0 = {weights0, -0.023859970271587372};
    neurons[0]=neuron0;

    static  float weights1[] ={
    0.18506574630737305, 0.33322885632514954, -0.4729088842868805, -0.4389359951019287, 
    -0.13666200637817383, 0.14063327014446259, -0.2314814329147339, -0.05981244146823883, 
    0.21091555058956146, 0.17167726159095764, 0.35224640369415283, -0.18918631970882416, 
    0.5511435270309448, 0.18879486620426178, -0.16103117167949677, -0.21243886649608612, 
  
    };
    static const neuron_t neuron1 = {weights1, -0.0380404032766819};
    neurons[1]=neuron1;

    static  float weights2[] ={
    -0.5832222700119019, -0.28389477729797363, -0.5953556895256042, 0.5785504579544067, 
    -0.018208591267466545, 0.2673604488372803, 0.23794518411159515, 0.43986478447914124, 
    0.5357155203819275, 0.45640623569488525, 0.6833311915397644, 0.22807109355926514, 
    -0.21745233237743378, 0.4484655261039734, -0.1250360757112503, 0.42878660559654236, 
  
    };
    static const neuron_t neuron2 = {weights2, -0.010956434532999992};
    neurons[2]=neuron2;

    static  float weights3[] ={
    -0.0883299708366394, 0.2642083764076233, 0.18341012299060822, 0.10484487563371658, 
    -0.2691355347633362, -0.12489628791809082, -0.3357875645160675, 0.4814322292804718, 
    -0.011422681622207165, -0.2789096534252167, -0.3710554242134094, 0.4175589382648468, 
    0.1842111051082611, -0.4110887348651886, 0.4932531416416168, 0.4317913055419922, 
  
    };
    static const neuron_t neuron3 = {weights3, -0.031128842383623123};
    neurons[3]=neuron3;

    static  float weights4[] ={
    -0.4119536876678467, 0.2500317394733429, 0.08296146243810654, -0.09164714813232422, 
    -0.15788426995277405, 0.1040060743689537, 0.3776238262653351, -0.4532207250595093, 
    -0.2986278533935547, 0.012495007365942001, 0.34013864398002625, -0.40048593282699585, 
    -0.238601416349411, -0.0585981048643589, 0.13206350803375244, 0.45713281631469727, 
  
    };
    static const neuron_t neuron4 = {weights4, -0.0196280088275671};
    neurons[4]=neuron4;

    static  float weights5[] ={
    0.4410502314567566, -0.237857386469841, 0.1567150354385376, -0.15804611146450043, 
    0.29997262358665466, -0.05982865020632744, -0.3929527997970581, -0.04862240329384804, 
    0.37176066637039185, -0.2191142588853836, 0.4906729757785797, -0.1297597736120224, 
    0.11900606751441956, 0.24180008471012115, 0.02626139484345913, -0.23935255408287048, 
  
    };
    static const neuron_t neuron5 = {weights5, -0.04529548063874245};
    neurons[5]=neuron5;

    static  float weights6[] ={
    0.1587308943271637, -0.08127433061599731, -0.16616998612880707, 0.038725998252630234, 
    -0.4327743351459503, 0.2090741991996765, -0.20083126425743103, 0.42727547883987427, 
    0.1573878675699234, 0.37968459725379944, -0.20799928903579712, -0.22131730616092682, 
    -0.17428991198539734, -0.47213271260261536, 0.2522473931312561, -0.2243061065673828, 
  
    };
    static const neuron_t neuron6 = {weights6, -0.014865831471979618};
    neurons[6]=neuron6;

    static  float weights7[] ={
    -0.5143515467643738, -0.020844222977757454, 0.22919005155563354, 0.03940049931406975, 
    0.27998992800712585, 0.3259555697441101, 0.4330555200576782, -0.41818803548812866, 
    -0.06834647804498672, -0.4539368152618408, -0.18865615129470825, 0.32339876890182495, 
    -0.28212863206863403, 0.18331125378608704, 0.32974791526794434, 0.022874141111969948, 
  
    };
    static const neuron_t neuron7 = {weights7, 0.03340807929635048};
    neurons[7]=neuron7;

    dense_layer_t layer= {8, neurons};
    return layer;
}

dense_layer_t init_dense_14_data(void){

    static neuron_t neurons[1];

    static  float weights0[] ={
    0.37506288290023804, 0.15159264206886292, -0.7213366031646729, 0.5631903409957886, 
    0.36200985312461853, 0.27989640831947327, 0.24966254830360413, -0.290385901927948, 
  
    };
    static const neuron_t neuron0 = {weights0, -0.0060277413576841354};
    neurons[0]=neuron0;

    dense_layer_t layer= {1, neurons};
    return layer;
}
